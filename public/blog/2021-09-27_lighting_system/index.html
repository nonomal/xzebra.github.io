<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="utf-8">
  <title>Lighting system</title>

  <meta name="author" content="Themefisher">
  <meta name="description" content=" Very simple lighting system with low graphics knowledge to give zworld a more interesting look. ">

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">

  <!-- Favicon -->
  <link rel="icon" href="http://localhost:8080/images/favicon.png" type="image/x-icon">

  <!-- CSS Plugins -->
  
<link rel="preconnect" href="https://fonts.gstatic.com">











<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Mulish:wght@500;600;700;800;900&amp;display=swap">




<link rel="stylesheet" href="http://localhost:8080/css/vendor.min.2fe473cf798783edd42c5c46c6d5927b6c63c811641e63cff3dcd725db6f4e1c91e9fad9ac98acc55959f39cb21db60a8b21cd91ff7e4fdd19b899f81161f724.css" integrity="sha512-L&#43;Rzz3mHg&#43;3ULFxGxtWSe2xjyBFkHmPP89zXJdtvThyR6frZrJisxVlZ85yyHbYKiyHNkf9&#43;T90ZuJn4EWH3JA==" media="screen">

</head>

<body>
  
  <div class="header-height-fix"></div>
<header class="header-nav">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <nav class="navbar navbar-expand-lg navbar-light p-0">
          <a class="navbar-brand font-weight-bold mr-0" href="http://localhost:8080/">
            
            <img loading="lazy" src="http://localhost:8080/images/favicon.png" alt="Zebra Blog" height="35px">
            
          </a>

          
          <button class="search-toggle d-inline-block d-lg-none ml-auto mr-3" data-toggle="search" aria-label="Search Toggle">
            <i class="las la-search"></i>
          </button>
          

          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navHeader" aria-controls="navHeader" aria-expanded="false" aria-label="Toggle navigation">
            <i class="d-inline lab la-buromobelexperte"></i>
            <i class="d-none las la-times"></i>
          </button>

          <div class="collapse navbar-collapse" id="navHeader">
            <ul class="navbar-nav mx-auto">

              
              
              
              
              
              <li class="nav-item ">
                <a class="nav-link" href="http://localhost:8080/">Home</a>
              </li>
              
              
              
              
              
              <li class="nav-item ">
                <a class="nav-link" href="http://localhost:8080/about/">About</a>
              </li>
              
              
              
              
              
              <li class="nav-item ">
                <a class="nav-link" href="http://localhost:8080/categories/">Categories</a>
              </li>
              
              
              
              
              
              <li class="nav-item ">
                <a class="nav-link" href="http://localhost:8080/tags/">Tags</a>
              </li>
              
              
            </ul>
            
            
            <div class="navbar-right d-none d-lg-inline-block">
              <ul class="social-links list-unstyled list-inline">
                <li class="list-inline-item ml-4 d-none d-lg-inline-block">
                  <button class="search-toggle" data-toggle="search" aria-label="Search Toggle">
                    <i class="las la-search"></i>
                  </button>
                </li>
              </ul>
            </div>
            
          </div>
        </nav>
      </div>
    </div>
  </div>
</header>


<div class="search-block">
  <div data-toggle="search-close">
    <i class="las la-times text-primary"></i>
  </div>
  <form action="/search">
    <input id="search-query" name="s" type="search" placeholder="Type words &amp; hit enter" class="text-center" aria-label="search-query">
  </form>
</div>

  
  




<section class="section-sm">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-10">
        <div class="text-center mb-5">
          <h3 class="h2 mb-4 post-title">Lighting system</h3>
          <ul class="card-meta list-inline">
            <li class="list-inline-item">
              <a href="#!" class="card-meta-author">
                
                <a href="http://localhost:8080/author/zebra/" class="card-meta-author">
                  <img loading="lazy" src="http://localhost:8080/images/author/zebra.png" alt="Zebra">
                  <span>Zebra</span>
                </a>
                
              </a>
            </li>
            <li class="list-inline-item">|</li>
            <li class="list-inline-item">
              <span>27 September 2021</span>
            </li>
          </ul>
        </div>

        
        <div class="mb-5 text-center">
          <img loading="lazy" class="img-fluid rounded" src="http://localhost:8080/images/posts/i.imgur.com_2OprBJL.png" alt="Image not Found">
        </div>
        

        <div class="content">
          <p>Lighting gives games a more professional look. I wanted to introduce a simple lighting system to light blocks and entities. The lighting ideas are mostly based on the game Starbound.</p>
<h1 id="background">Background</h1>
<p>I have very little knowledge about computer graphics and shaders and had to find an easy method for lighting tiles depending on light propagation; I found two resources.</p>
<p>The first one is a very explanatory blog post about how light diffusion works and some tricks to achieve it. But I couldn’t think of implementing it with just that information.</p>
<p>Then, I saw the second one. A video explaining how in a very simple way you could create a light map and then plot the light on top of the drawings without using shaders.</p>
<h1 id="solution-overview">Solution Overview</h1>
<h2 id="light-map">Light map</h2>
<p>The video shows a very CPU intensive way of calculating color mixes and graphics logic that could be sped up by relying on the GPU. This made me thought about actually doing a lighting map as a texture, and rely on the GPU for all the mixing and blurring.</p>
<p>Once calculated the light map, we need to plot it to the screen. To do so, we need to generate a new texture and render all the tile lights. To apply the lights, we will use the blend multiply mode, so black tiles will be render black and white tiles should be render as normal. The more dark the tile in the light map, the darker it will look.</p>
<h2 id="light-propagation">Light propagation</h2>
<p>The main problem to solve was how to propagate light. As both resources mention, one of the best ways to simulate light propagation is by using BFS, as it reduces considerably the number of tiles repeated (not like DFS). Also, it is a very realistic approach as light tends to propagate like a fluid (instead of flowing, bouncing on surfaces). BFS achieves this realistic effect as it can simulate a fluid (color) flow by reducing the color intensity on each step.</p>
<p>This effect looked blocky at first, because the texture I was drawing the lights to was the real size of the map. I tried to use multiple shaders to try to blur the shadows’ transitions, but they still looked blocky.</p>
<p><img src="/images/posts/s3.us-west-2.amazonaws.com_41092085-B07E-4853-875C-ABCAF04B08C7.png" alt=""></p>
<p>So I came up with the solution of relying on the GPU again. When you resize a texture, you can do it with a <em>nearest neighbour</em> mode to keep the pixel-ness of the texture, but it can also be used the opposite way. One of the best ways to get a very neat blur on a texture is by scaling it with a <em>linear</em> mode.</p>
<ol>
<li>Make sure to enable clamp mode when you resize the texture, or there could be artifacts on the drawing.</li>
</ol>
<p>Once I came up with this, I changed the light map texture size to be 1 tile - 1 pixel. That way, when being resized, the lights will smooth themselves and we would use less resources to keep the texture stored and draw into it. The result is the way I expected lights to be.</p>
<p><img src="/images/posts/s3.us-west-2.amazonaws.com_6ECF2468-F1CC-4C59-B9E6-0651CBE0D2F6.png" alt=""></p>
<h2 id="light-diffusion">Light diffusion</h2>
<p><em>Wait… The second picture looks so much more realistic. How is that possible?</em></p>
<p>Well, a very important step to achieve a realistic feel in your lighting system comes from how well you diffuse light. Light diffusion is a natural phenomena that is easy to contemplate, just turn a light in the middle of a room; not all the room will be lighted the same way.</p>
<p>Light also has some obvious problem to pass through objects that are not transparent. It also has some kind of “friction” (not the best term but it does the job).</p>
<p>This friction or drop-off can be modeled such as the light loses strength when propagating (mentioned in the previous part) and, when it passes through a block, it increases a lot.</p>
<h2 id="intensity-of-lights">Intensity of lights</h2>
<p>We got a very simple lighting system working. But it shouldn’t be very hard to implement different light properties. In this example, we will be implementing light intensity.</p>
<p>Light intensity (or at least how I called) is the property of light to expand more. A very intense light may light a whole stadium, but a low intensity light may not be able to even light your hand. This is a cool property to implement in order to have glowing blocks of all kinds.</p>
<p>Let’s think about magma or lava blocks. Lava emits light, enough to light its surroundings. But magma is rocks and lava mixed, so it should emit a timid light. This is where light intensity concept comes.</p>
<p><img src="/images/posts/s3.us-west-2.amazonaws.com_7766C097-C986-4FCC-B306-24D2F5F89181.png" alt=""></p>
<p>By modifying the lighting system to propagate the original light’s intensity in each step of the BFS, we can multiply the intensity ([0..1]) and the light drop-off ([0..1]). Meaning that a lower light intensity would increase the drop-off, making it harder for the light to propagate.</p>
<h1 id="conclusion">Conclusion</h1>
<p>I thought that a light system would be a very shader intensive task but with the light map texture trick, a 2D block lighting system can be easily implemented with just a queue and a bunch of multiplications.</p>
<p>It is also important to say that none of those light calculations are happening in the same thread of the game, as games require its main thread to run as fast as possible (in order to update and draw correctly).</p>

        </div>
      </div>
    </div>

    <div class="single-post-meta">
      <div class="row justify-content-center">
        <div class="col-lg-5 col-md-6 text-center text-md-left">
          <ul class="post-meta-tags list-unstyled list-inline">
            
            <li class="list-inline-item"><a href="http://localhost:8080/tags/lights">lights</a></li>
            
            <li class="list-inline-item"><a href="http://localhost:8080/tags/visual">visual</a></li>
            
          </ul>
        </div>
        <div class="col-lg-5 col-md-6 text-center text-md-right mt-4 mt-md-0">
<ul class="social-links has-bg-color list-unstyled list-inline" style="line-height:0">
  <li class="list-inline-item">
    
    <a class="resp-sharing-button__link d-block" href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a8080%2fblog%2f2021-09-27_lighting_system%2f" target="_blank"
      rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small">
        <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <i class="lab la-facebook-f text-dark"></i>
        </div>
      </div>
    </a>
  </li>

  <li class="list-inline-item">
    
    <a class="resp-sharing-button__link d-block" href="https://twitter.com/intent/tweet/?text=Lighting%20system&amp;url=http%3a%2f%2flocalhost%3a8080%2fblog%2f2021-09-27_lighting_system%2f"
      target="_blank" rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small">
        <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <i class="lab la-twitter text-dark"></i>
        </div>
      </div>
    </a>
  </li>

  <li class="list-inline-item">
    
    <a class="resp-sharing-button__link d-block" href="https://plus.google.com/share?url=http%3a%2f%2flocalhost%3a8080%2fblog%2f2021-09-27_lighting_system%2f" target="_blank"
      rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--google resp-sharing-button--small">
        <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <i class="lab la-google-plus-g text-dark"></i>
        </div>
      </div>
    </a>
  </li>

  <li class="list-inline-item">
    
    <a class="resp-sharing-button__link d-block" href="mailto:?subject=Lighting%20system&amp;body=http%3a%2f%2flocalhost%3a8080%2fblog%2f2021-09-27_lighting_system%2f" target="_self"
      rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small">
        <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <i class="las la-envelope text-dark"></i>
        </div>
      </div>
    </a>
  </li>

  <li class="list-inline-item">
    
    <a class="resp-sharing-button__link d-block" href="whatsapp://send?text=Lighting%20system%20http%3a%2f%2flocalhost%3a8080%2fblog%2f2021-09-27_lighting_system%2f" target="_blank"
      rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small">
        <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <i class="lab la-whatsapp text-dark"></i>
        </div>
      </div>
    </a>
  </li>

</ul></div>
      </div>
    </div>

    <div class="single-post-author">
      <div class="row justify-content-center">
        <div class="col-lg-10">
          <div class="media d-block d-sm-flex text-center text-sm-left">
            
            <a href="http://localhost:8080/author/zebra/"><img loading="lazy" class="img-fluid rounded-circle mr-0 mr-sm-4 mb-4" src="http://localhost:8080/images/author/zebra.png" alt="Zebra"></a>
            <div class="media-body">
              <p class="font-primary mb-1">Written By</p>
              <h4><a href="http://localhost:8080/author/zebra/" class="text-dark font-weight-700">Zebra</a></h4>
              <p class="font-primary">Student of Computer Science at University of Zaragoza (🇪🇸). Cybersecurity enthusiast. Golang developer. Cat lover.</p>
              <ul class="social-links list-unstyled list-inline ml-0 ml-sm-n2">
                
                <li class="list-inline-item"><a href="https://www.github.com/xzebra">
                    <i class="lab lab la-github"></i>
                  </a></li>
                
                <li class="list-inline-item"><a href="https://app.hackthebox.eu/users/680488">
                    <i class="lab las la-cube"></i>
                  </a></li>
                
                <li class="list-inline-item"><a href="https://www.linkedin.com/in/jorge-romanos-a97174161/">
                    <i class="lab lab la-linkedin-in"></i>
                  </a></li>
                
              </ul>
            </div>
            
          </div>
        </div>
      </div>
    </div>

    <div class="single-post-similer">
      <div class="row justify-content-center">
        <div class="col-lg-10">
          <div class="row mt-3">
            <div class="col-12">
              <h3 class="text-dark font-weight-800 mb-4 pb-2">You May Also Like</h3>
            </div>
            
              
            <div class="col-md-6">
              <article class="card post-card">
  
  <a href="http://localhost:8080/blog/2021-09-17_golang_init_function/">
    <img loading="lazy" class="w-100 rounded" src="http://localhost:8080/images/posts/i.imgur.com_z111iEy.png" alt="Golang init() function">
  </a>
  
  <div class="card-body">
    <ul class="card-meta list-inline mb-2">
      <li class="list-inline-item mb-2">
        
        <a href="http://localhost:8080/author/zebra/" class="card-meta-author">
          
          <img loading="lazy" src="http://localhost:8080/images/author/zebra.png" alt="Zebra">
          
          <span>Zebra</span>
        </a>
        
      </li>
      <li class="list-inline-item mb-2">
        <span>17 Sep, 2021</span>
      </li>
      <li class="list-inline-item mb-2">
        <ul class="card-meta-tag list-inline">
          
        </ul>
      </li>
    </ul>
    <h3 class="mb-3">
      <a class="post-title" href="http://localhost:8080/blog/2021-09-17_golang_init_function/">Golang init() function</a>
    </h3>
    <p>This post is about the init function in golang and how it can be used for package initialization, avoiding filling the main function with …</p>

    
  </div>
</article>
            </div>
            
            <div class="col-md-6">
              <article class="card post-card">
  
  <a href="http://localhost:8080/blog/2021-09-05_client_authentication/">
    <img loading="lazy" class="w-100 rounded" src="http://localhost:8080/images/posts/i.imgur.com_zI8WrkR.png" alt="Client authentication">
  </a>
  
  <div class="card-body">
    <ul class="card-meta list-inline mb-2">
      <li class="list-inline-item mb-2">
        
        <a href="http://localhost:8080/author/zebra/" class="card-meta-author">
          
          <img loading="lazy" src="http://localhost:8080/images/author/zebra.png" alt="Zebra">
          
          <span>Zebra</span>
        </a>
        
      </li>
      <li class="list-inline-item mb-2">
        <span>05 Sep, 2021</span>
      </li>
      <li class="list-inline-item mb-2">
        <ul class="card-meta-tag list-inline">
          
        </ul>
      </li>
    </ul>
    <h3 class="mb-3">
      <a class="post-title" href="http://localhost:8080/blog/2021-09-05_client_authentication/">Client authentication</a>
    </h3>
    <p>Client-server encryption and authentication based on Minecraft server.
Protocol C: client
S: server
C → S: Login request Client requests the login …</p>

    
  </div>
</article>
            </div>
            
          </div>
        </div>
      </div>
    </div>
  </div>
</section>




  <footer class="pt-4 pb-5">
  <div class="container">
    <div class="row justify-content-center align-items-center">
      <div class="col-lg-5">
        
        
        
      </div>
      
      <div class="col-lg-12 text-center ">
      
        <ul class="list-inline footer-menu mb-4">
          
        </ul>
        <ul class="social-links icon-box list-unstyled list-inline font-weight-500 mb-3">
          
        </ul>
        
        <p class="mb-0 font-weight-500 copyright-text content">Made with ❤ by <a href="https://github.com/xzebra">Zebra</a></p>
        
      </div>
    </div>
  </div>
</footer>

  




  



  



  



  



  



  




<script data-turbolinks-suppress-warning src="/js/vendor.min.104c16bb588dd60f4bc0cbb9828dcf214eb0a6775f69f74f025b75dc5aac73eb47da26aef00c8f4e3d7a85099a8054c195d03d63aa88d1b4213a47274755994e.js" integrity="sha512-EEwWu1iN1g9LwMu5go3PIU6wpndfafdPAlt13Fqsc&#43;tH2iau8AyPTj16hQmagFTBldA9Y6qI0bQhOkcnR1WZTg=="></script>



</body>

</html>