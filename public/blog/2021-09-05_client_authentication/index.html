<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="utf-8">
  <title>Client authentication</title>

  <meta name="author" content="Themefisher">
  <meta name="description" content="  This is meta description  ">

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">

  <!-- Favicon -->
  <link rel="icon" href="http://localhost:8080/images/favicon.png" type="image/x-icon">

  <!-- CSS Plugins -->
  
<link rel="preconnect" href="https://fonts.gstatic.com">











<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Mulish:wght@500;600;700;800;900&amp;display=swap">




<link rel="stylesheet" href="http://localhost:8080/css/vendor.min.2fe473cf798783edd42c5c46c6d5927b6c63c811641e63cff3dcd725db6f4e1c91e9fad9ac98acc55959f39cb21db60a8b21cd91ff7e4fdd19b899f81161f724.css" integrity="sha512-L&#43;Rzz3mHg&#43;3ULFxGxtWSe2xjyBFkHmPP89zXJdtvThyR6frZrJisxVlZ85yyHbYKiyHNkf9&#43;T90ZuJn4EWH3JA==" media="screen">

</head>

<body>
  
  <div class="header-height-fix"></div>
<header class="header-nav">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <nav class="navbar navbar-expand-lg navbar-light p-0">
          <a class="navbar-brand font-weight-bold mr-0" href="http://localhost:8080/">
            
            <img loading="lazy" src="http://localhost:8080/images/favicon.png" alt="Zebra Blog" height="35px">
            
          </a>

          
          <button class="search-toggle d-inline-block d-lg-none ml-auto mr-3" data-toggle="search" aria-label="Search Toggle">
            <i class="las la-search"></i>
          </button>
          

          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navHeader" aria-controls="navHeader" aria-expanded="false" aria-label="Toggle navigation">
            <i class="d-inline lab la-buromobelexperte"></i>
            <i class="d-none las la-times"></i>
          </button>

          <div class="collapse navbar-collapse" id="navHeader">
            <ul class="navbar-nav mx-auto">

              
              
              
              
              
              <li class="nav-item ">
                <a class="nav-link" href="http://localhost:8080/">Home</a>
              </li>
              
              
              
              
              
              <li class="nav-item ">
                <a class="nav-link" href="http://localhost:8080/about/">About</a>
              </li>
              
              
              
              
              
              <li class="nav-item ">
                <a class="nav-link" href="http://localhost:8080/categories/">Categories</a>
              </li>
              
              
              
              
              
              <li class="nav-item ">
                <a class="nav-link" href="http://localhost:8080/tags/">Tags</a>
              </li>
              
              
            </ul>
            
            
            <div class="navbar-right d-none d-lg-inline-block">
              <ul class="social-links list-unstyled list-inline">
                <li class="list-inline-item ml-4 d-none d-lg-inline-block">
                  <button class="search-toggle" data-toggle="search" aria-label="Search Toggle">
                    <i class="las la-search"></i>
                  </button>
                </li>
              </ul>
            </div>
            
          </div>
        </nav>
      </div>
    </div>
  </div>
</header>


<div class="search-block">
  <div data-toggle="search-close">
    <i class="las la-times text-primary"></i>
  </div>
  <form action="/search">
    <input id="search-query" name="s" type="search" placeholder="Type words &amp; hit enter" class="text-center" aria-label="search-query">
  </form>
</div>

  
  




<section class="section-sm">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-10">
        <div class="text-center mb-5">
          <h3 class="h2 mb-4 post-title">Client authentication</h3>
          <ul class="card-meta list-inline">
            <li class="list-inline-item">
              <a href="#!" class="card-meta-author">
                
                <a href="http://localhost:8080/author/zebra/" class="card-meta-author">
                  <img loading="lazy" src="http://localhost:8080/images/author/zebra.png" alt="Zebra">
                  <span>Zebra</span>
                </a>
                
              </a>
            </li>
            <li class="list-inline-item">|</li>
            <li class="list-inline-item">
              <span>05 September 2021</span>
            </li>
          </ul>
        </div>

        
        <div class="mb-5 text-center">
          <img loading="lazy" class="img-fluid rounded" src="http://localhost:8080/images/posts/i.imgur.com_zI8WrkR.png" alt="Image not Found">
        </div>
        

        <div class="content">
          <p>Client-server encryption and authentication based on Minecraft server.</p>
<h1 id="protocol">Protocol</h1>
<p>C: client</p>
<p>S: server</p>
<h2 id="c--s-login-request">C → S: Login request</h2>
<p>Client requests the login process to start.</p>
<h2 id="s--c-encryption-request">S → C: Encryption request</h2>
<p>Server generates a random verify token.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#a6e22e">verifyToken</span> <span style="color:#f92672">:=</span> make([]<span style="color:#66d9ef">byte</span>, <span style="color:#a6e22e">verifyTokenLength</span>)
<span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Read</span>(<span style="color:#a6e22e">verifyToken</span>)
</code></pre></div><p>Server also generates an unique random 16-byte token for authenticating ownership of client&rsquo;s packets (once the login process has ended). The auth token won&rsquo;t be encrypted, so the server knows the owner of each packet.</p>
<p>Server sends his public key in PKIX, ASN.1 DER format.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#a6e22e">asn1PublicKey</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">MarshalPXIXPublicKey</span>(<span style="color:#a6e22e">global</span>.<span style="color:#a6e22e">PublicKey</span>)
</code></pre></div><h2 id="c--s-encryption-response">C → S: Encryption response</h2>
<p>Client generates a shared 16-byte token used as symmetric key, that will be sent to the server encrypted with it&rsquo;s public key. Client also encrypts the verify token.</p>
<p>Once this step is completed, the content of the packet will be encrypted using the symmetric key.</p>
<p>The server decrypts the shared secret and the verify token using its private key:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#a6e22e">secret</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rsa</span>.<span style="color:#a6e22e">DecryptPKCS1v15</span>(<span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Reader</span>, <span style="color:#a6e22e">global</span>.<span style="color:#a6e22e">PrivateKey</span>, <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">Secret</span>)
<span style="color:#a6e22e">verifyToken</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rsa</span>.<span style="color:#a6e22e">DecryptPKCS1v15</span>(<span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Reader</span>, <span style="color:#a6e22e">global</span>.<span style="color:#a6e22e">PrivateKey</span>, <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">VerifyToken</span>)
</code></pre></div><p>And then it compares the verify token:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">bytes</span>.<span style="color:#a6e22e">Compare</span>(<span style="color:#a6e22e">token</span>, <span style="color:#a6e22e">verifyToken</span>) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> { <span style="color:#f92672">...</span> } <span style="color:#75715e">// error
</span></code></pre></div><h2 id="c--s-enable-auth">C &amp; S: Enable auth</h2>
<p>Both enable AES/CFB8 encryption using the shared secret token as both IV and key.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#a6e22e">block</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">aes</span>.<span style="color:#a6e22e">NewCipher</span>(<span style="color:#a6e22e">secret</span>)
<span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">SetCipher</span>(
	<span style="color:#a6e22e">CFB8</span>.<span style="color:#a6e22e">NewCFB8Encrypt</span>(<span style="color:#a6e22e">block</span>, <span style="color:#a6e22e">secret</span>),
	<span style="color:#a6e22e">CFB8</span>.<span style="color:#a6e22e">NewCFB8Decrypt</span>(<span style="color:#a6e22e">block</span>, <span style="color:#a6e22e">secret</span>),
)
</code></pre></div><h1 id="questions">Questions</h1>
<ul>
<li><strong>What if someone intercepts the auth token?</strong> Nothing would happen as the actual authority of packets is determined by the ability to encrypt the packets with the symmetric key.</li>
<li>**Should authority be considered before login? **No, the encryption ensures the client who requested the connection is the one who is performing it, but unless he logs in, he can&rsquo;t be the user he claims to be.</li>
<li>**This authenticates the users, but does it authenticate the server? **No, and this should be considered in a future (). If server&rsquo;s public distributio distributed by a trusted entity, clients could be fooled by a malicious server and steal client&rsquo;s password.</li>
</ul>

        </div>
      </div>
    </div>

    <div class="single-post-meta">
      <div class="row justify-content-center">
        <div class="col-lg-5 col-md-6 text-center text-md-left">
          <ul class="post-meta-tags list-unstyled list-inline">
            
          </ul>
        </div>
        <div class="col-lg-5 col-md-6 text-center text-md-right mt-4 mt-md-0">
<ul class="social-links has-bg-color list-unstyled list-inline" style="line-height:0">
  <li class="list-inline-item">
    
    <a class="resp-sharing-button__link d-block" href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a8080%2fblog%2f2021-09-05_client_authentication%2f" target="_blank"
      rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small">
        <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <i class="lab la-facebook-f text-dark"></i>
        </div>
      </div>
    </a>
  </li>

  <li class="list-inline-item">
    
    <a class="resp-sharing-button__link d-block" href="https://twitter.com/intent/tweet/?text=Client%20authentication&amp;url=http%3a%2f%2flocalhost%3a8080%2fblog%2f2021-09-05_client_authentication%2f"
      target="_blank" rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small">
        <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <i class="lab la-twitter text-dark"></i>
        </div>
      </div>
    </a>
  </li>

  <li class="list-inline-item">
    
    <a class="resp-sharing-button__link d-block" href="https://plus.google.com/share?url=http%3a%2f%2flocalhost%3a8080%2fblog%2f2021-09-05_client_authentication%2f" target="_blank"
      rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--google resp-sharing-button--small">
        <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <i class="lab la-google-plus-g text-dark"></i>
        </div>
      </div>
    </a>
  </li>

  <li class="list-inline-item">
    
    <a class="resp-sharing-button__link d-block" href="mailto:?subject=Client%20authentication&amp;body=http%3a%2f%2flocalhost%3a8080%2fblog%2f2021-09-05_client_authentication%2f" target="_self"
      rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small">
        <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <i class="las la-envelope text-dark"></i>
        </div>
      </div>
    </a>
  </li>

  <li class="list-inline-item">
    
    <a class="resp-sharing-button__link d-block" href="whatsapp://send?text=Client%20authentication%20http%3a%2f%2flocalhost%3a8080%2fblog%2f2021-09-05_client_authentication%2f" target="_blank"
      rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small">
        <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <i class="lab la-whatsapp text-dark"></i>
        </div>
      </div>
    </a>
  </li>

</ul></div>
      </div>
    </div>

    <div class="single-post-author">
      <div class="row justify-content-center">
        <div class="col-lg-10">
          <div class="media d-block d-sm-flex text-center text-sm-left">
            
            <a href="http://localhost:8080/author/zebra/"><img loading="lazy" class="img-fluid rounded-circle mr-0 mr-sm-4 mb-4" src="http://localhost:8080/images/author/zebra.png" alt="Zebra"></a>
            <div class="media-body">
              <p class="font-primary mb-1">Written By</p>
              <h4><a href="http://localhost:8080/author/zebra/" class="text-dark font-weight-700">Zebra</a></h4>
              <p class="font-primary">Student of Computer Science at University of Zaragoza (🇪🇸). Cybersecurity enthusiast. Golang developer. Cat lover.</p>
              <ul class="social-links list-unstyled list-inline ml-0 ml-sm-n2">
                
                <li class="list-inline-item"><a href="https://www.github.com/xzebra">
                    <i class="lab lab la-github"></i>
                  </a></li>
                
                <li class="list-inline-item"><a href="https://app.hackthebox.eu/users/680488">
                    <i class="lab las la-cube"></i>
                  </a></li>
                
                <li class="list-inline-item"><a href="https://www.linkedin.com/in/jorge-romanos-a97174161/">
                    <i class="lab lab la-linkedin-in"></i>
                  </a></li>
                
              </ul>
            </div>
            
          </div>
        </div>
      </div>
    </div>

    <div class="single-post-similer">
      <div class="row justify-content-center">
        <div class="col-lg-10">
          <div class="row mt-3">
            <div class="col-12">
              <h3 class="text-dark font-weight-800 mb-4 pb-2">You May Also Like</h3>
            </div>
            
              
            <div class="col-md-6">
              <article class="card post-card">
  
  <a href="http://localhost:8080/blog/2021-09-27_lighting_system/">
    <img loading="lazy" class="w-100 rounded" src="http://localhost:8080/images/posts/i.imgur.com_2OprBJL.png" alt="Lighting system">
  </a>
  
  <div class="card-body">
    <ul class="card-meta list-inline mb-2">
      <li class="list-inline-item mb-2">
        
        <a href="http://localhost:8080/author/zebra/" class="card-meta-author">
          
          <img loading="lazy" src="http://localhost:8080/images/author/zebra.png" alt="Zebra">
          
          <span>Zebra</span>
        </a>
        
      </li>
      <li class="list-inline-item mb-2">
        <span>27 Sep, 2021</span>
      </li>
      <li class="list-inline-item mb-2">
        <ul class="card-meta-tag list-inline">
          
          <li class="list-inline-item"><a href="http://localhost:8080/tags/lights">lights</a></li>
          
          <li class="list-inline-item"><a href="http://localhost:8080/tags/visual">visual</a></li>
          
        </ul>
      </li>
    </ul>
    <h3 class="mb-3">
      <a class="post-title" href="http://localhost:8080/blog/2021-09-27_lighting_system/">Lighting system</a>
    </h3>
    <p>Lighting gives games a more professional look. I wanted to introduce a simple lighting system to light blocks and entities. The lighting ideas are …</p>

    
  </div>
</article>
            </div>
            
            <div class="col-md-6">
              <article class="card post-card">
  
  <a href="http://localhost:8080/blog/2021-09-17_golang_init_function/">
    <img loading="lazy" class="w-100 rounded" src="http://localhost:8080/images/posts/i.imgur.com_z111iEy.png" alt="Golang init() function">
  </a>
  
  <div class="card-body">
    <ul class="card-meta list-inline mb-2">
      <li class="list-inline-item mb-2">
        
        <a href="http://localhost:8080/author/zebra/" class="card-meta-author">
          
          <img loading="lazy" src="http://localhost:8080/images/author/zebra.png" alt="Zebra">
          
          <span>Zebra</span>
        </a>
        
      </li>
      <li class="list-inline-item mb-2">
        <span>17 Sep, 2021</span>
      </li>
      <li class="list-inline-item mb-2">
        <ul class="card-meta-tag list-inline">
          
        </ul>
      </li>
    </ul>
    <h3 class="mb-3">
      <a class="post-title" href="http://localhost:8080/blog/2021-09-17_golang_init_function/">Golang init() function</a>
    </h3>
    <p>This post is about the init function in golang and how it can be used for package initialization, avoiding filling the main function with …</p>

    
  </div>
</article>
            </div>
            
          </div>
        </div>
      </div>
    </div>
  </div>
</section>




  <footer class="pt-4 pb-5">
  <div class="container">
    <div class="row justify-content-center align-items-center">
      <div class="col-lg-5">
        
        
        
      </div>
      
      <div class="col-lg-12 text-center ">
      
        <ul class="list-inline footer-menu mb-4">
          
        </ul>
        <ul class="social-links icon-box list-unstyled list-inline font-weight-500 mb-3">
          
        </ul>
        
        <p class="mb-0 font-weight-500 copyright-text content">Made with ❤ by <a href="https://github.com/xzebra">Zebra</a></p>
        
      </div>
    </div>
  </div>
</footer>

  




  



  



  



  



  



  




<script data-turbolinks-suppress-warning src="/js/vendor.min.104c16bb588dd60f4bc0cbb9828dcf214eb0a6775f69f74f025b75dc5aac73eb47da26aef00c8f4e3d7a85099a8054c195d03d63aa88d1b4213a47274755994e.js" integrity="sha512-EEwWu1iN1g9LwMu5go3PIU6wpndfafdPAlt13Fqsc&#43;tH2iau8AyPTj16hQmagFTBldA9Y6qI0bQhOkcnR1WZTg=="></script>



</body>

</html>